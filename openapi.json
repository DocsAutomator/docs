{
  "openapi": "3.1.0",
  "info": {
    "title": "DocsAutomator API",
    "version": "2.0",
    "description": "REST API for programmatic document generation, automation management, and e-signature workflows.",
    "contact": {
      "name": "DocsAutomator Support",
      "email": "support@docsautomator.co",
      "url": "https://docsautomator.co"
    }
  },
  "servers": [
    {
      "url": "https://api.docsautomator.co",
      "description": "Production"
    }
  ],
  "security": [
    {
      "bearerAuth": []
    }
  ],
  "tags": [
    {
      "name": "Documents",
      "description": "Create documents and manage async jobs"
    },
    {
      "name": "Automations",
      "description": "CRUD operations for automations"
    },
    {
      "name": "Templates",
      "description": "Template placeholders and duplication"
    },
    {
      "name": "E-Signatures",
      "description": "Manage signing sessions, links, and audit trails"
    },
    {
      "name": "Email",
      "description": "Test email delivery"
    }
  ],
  "paths": {
    "/createDocument": {
      "post": {
        "operationId": "createDocument",
        "tags": ["Documents"],
        "summary": "Create a document",
        "description": "Triggers document generation from an automation template (Google Doc or PDF). Supports sync mode (waits for result) and async mode (returns a job ID for polling). The response includes PDF and optional Google Doc URLs.\n\nWhen the automation has e-signatures enabled and the template contains e-sign placeholders, a signing session is automatically created and included in the response.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["docId"],
                "properties": {
                  "docId": {
                    "type": "string",
                    "description": "The automation ID to execute. Also accepted as `automationId`."
                  },
                  "data": {
                    "type": "object",
                    "additionalProperties": true,
                    "description": "Key-value pairs for template placeholders. Keys must match placeholder names in your template (Google Doc syntax or PDF placeholder names).",
                    "example": {
                      "customer_name": "Acme Corp",
                      "invoice_date": "2025-01-15",
                      "total": "$1,500.00"
                    }
                  },
                  "documentName": {
                    "type": "string",
                    "description": "Custom name for the generated document. Overrides the automation's document name setting."
                  },
                  "async": {
                    "type": "boolean",
                    "default": false,
                    "description": "When `true`, returns immediately with a `jobId` (HTTP 202). Poll `GET /job/{jobId}` for the result. When `false` (default), the request blocks until the document is ready (up to 5 minutes)."
                  },
                  "recId": {
                    "type": "string",
                    "description": "Airtable record ID. Required when the automation's data source is Airtable."
                  },
                  "rowNumber": {
                    "type": "integer",
                    "description": "Google Sheets row number. Required when the automation's data source is Google Sheets."
                  },
                  "line_items_1": {
                    "type": "array",
                    "items": {
                      "$ref": "#/components/schemas/LineItem"
                    },
                    "description": "First set of line items. Each object's keys must match line item placeholder names. Use the `children` key for nested line items (up to 3 levels)."
                  },
                  "line_items_2": {
                    "type": "array",
                    "items": {
                      "$ref": "#/components/schemas/LineItem"
                    },
                    "description": "Second set of line items."
                  },
                  "line_items_3": {
                    "type": "array",
                    "items": {
                      "$ref": "#/components/schemas/LineItem"
                    },
                    "description": "Third set of line items."
                  },
                  "conditionalRendering": {
                    "type": "object",
                    "additionalProperties": {
                      "type": "boolean"
                    },
                    "description": "Control conditional section visibility. Keys are section names, values are booleans.",
                    "example": {
                      "show_discount": true,
                      "show_notes": false
                    }
                  },
                  "lineDeletions": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    },
                    "description": "Placeholder keys whose empty rows/paragraphs should be deleted from the output."
                  },
                  "webhookParams": {
                    "type": "object",
                    "additionalProperties": true,
                    "description": "Custom parameters passed through to webhook notifications as `additionalParams`."
                  },
                  "existingPdfs": {
                    "type": "array",
                    "items": {
                      "type": "string",
                      "format": "uri"
                    },
                    "description": "PDF URLs to merge or prepend to the generated document."
                  },
                  "docTemplateLink": {
                    "type": "string",
                    "format": "uri",
                    "description": "Override the automation's Google Doc template URL for this request only."
                  }
                }
              },
              "examples": {
                "simple": {
                  "summary": "Simple document",
                  "value": {
                    "docId": "abc123",
                    "data": {
                      "customer_name": "Acme Corp",
                      "invoice_date": "2025-01-15",
                      "total": "$1,500.00"
                    }
                  }
                },
                "withLineItems": {
                  "summary": "With line items",
                  "value": {
                    "docId": "abc123",
                    "documentName": "Invoice #001",
                    "data": {
                      "customer_name": "Acme Corp",
                      "invoice_date": "2025-01-15"
                    },
                    "line_items_1": [
                      {
                        "description": "Consulting",
                        "quantity": 10,
                        "rate": 150,
                        "amount": 1500
                      },
                      {
                        "description": "Development",
                        "quantity": 20,
                        "rate": 200,
                        "amount": 4000
                      }
                    ]
                  }
                },
                "nestedLineItems": {
                  "summary": "Nested line items",
                  "value": {
                    "docId": "abc123",
                    "data": {
                      "project_name": "Website Redesign"
                    },
                    "line_items_1": [
                      {
                        "phase": "Design",
                        "children": [
                          {
                            "task": "Wireframes",
                            "hours": 8,
                            "children": [
                              {
                                "detail": "Homepage wireframe",
                                "status": "Complete"
                              }
                            ]
                          }
                        ]
                      }
                    ]
                  }
                },
                "async": {
                  "summary": "Async mode",
                  "value": {
                    "docId": "abc123",
                    "async": true,
                    "data": {
                      "customer_name": "Acme Corp"
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Document created successfully (sync mode)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/DocumentCreationResponse"
                }
              }
            }
          },
          "202": {
            "description": "Document creation queued (async mode)",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Document creation request queued."
                    },
                    "jobId": {
                      "type": "string",
                      "description": "Job ID for polling via `GET /job/{jobId}`."
                    },
                    "logId": {
                      "type": "string",
                      "description": "Request log ID for tracking."
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "402": {
            "description": "Document limit exceeded",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "error": "Document limit reached. Enable overage billing or upgrade your plan."
                }
              }
            }
          },
          "404": {
            "$ref": "#/components/responses/NotFound"
          }
        }
      }
    },
    "/job/{jobId}": {
      "get": {
        "operationId": "getJobStatus",
        "tags": ["Documents"],
        "summary": "Get job status",
        "description": "Check the status of an async document creation job. Poll this endpoint after receiving a `jobId` from `POST /createDocument` with `async: true`.\n\nProgress values: 10% (queued) → 20% (fetching data) → 30% (processing template) → 40% (generating PDF) → 100% (complete).",
        "parameters": [
          {
            "name": "jobId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "The job ID returned from async document creation."
          }
        ],
        "responses": {
          "200": {
            "description": "Job status retrieved",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/JobStatus"
                }
              }
            }
          },
          "404": {
            "$ref": "#/components/responses/NotFound"
          }
        }
      }
    },
    "/queue/stats": {
      "get": {
        "operationId": "getQueueStats",
        "tags": ["Documents"],
        "summary": "Get queue statistics",
        "description": "Returns current document generation queue statistics for your workspace.",
        "responses": {
          "200": {
            "description": "Queue statistics",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/QueueStats"
                }
              }
            }
          }
        }
      }
    },
    "/automations": {
      "get": {
        "operationId": "listAutomations",
        "tags": ["Automations"],
        "summary": "List automations",
        "description": "Retrieves all automations in the workspace with their configuration details.",
        "responses": {
          "200": {
            "description": "List of automations",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "automations": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/Automation"
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          }
        }
      }
    },
    "/automation": {
      "get": {
        "operationId": "getAutomation",
        "tags": ["Automations"],
        "summary": "Get automation",
        "description": "Retrieves a single automation by ID with full configuration details.",
        "parameters": [
          {
            "name": "automationId",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "The automation ID."
          }
        ],
        "responses": {
          "200": {
            "description": "Automation details",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "automation": {
                      "$ref": "#/components/schemas/Automation"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "404": {
            "$ref": "#/components/responses/NotFound"
          }
        }
      }
    },
    "/createAutomation": {
      "post": {
        "operationId": "createAutomation",
        "tags": ["Automations"],
        "summary": "Create automation",
        "description": "Creates a new automation with the specified data source and optional Google Doc template. PDF templates are uploaded through the DocsAutomator app.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["title", "dataSourceName"],
                "properties": {
                  "title": {
                    "type": "string",
                    "description": "Name for the automation."
                  },
                  "dataSourceName": {
                    "type": "string",
                    "enum": ["Airtable", "API", "ClickUp", "Glide", "Google Sheets", "Make", "n8n", "Noloco", "SmartSuite", "Zapier"],
                    "description": "The data source type."
                  },
                  "docTemplateLink": {
                    "type": "string",
                    "format": "uri",
                    "description": "Google Doc template URL."
                  }
                }
              },
              "example": {
                "title": "Invoice Generator",
                "dataSourceName": "API",
                "docTemplateLink": "https://docs.google.com/document/d/1abc.../edit"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Automation created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "success"
                    },
                    "newAutomation": {
                      "$ref": "#/components/schemas/Automation"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          }
        }
      }
    },
    "/updateAutomation": {
      "put": {
        "operationId": "updateAutomation",
        "tags": ["Automations"],
        "summary": "Update automation",
        "description": "Updates an existing automation's settings. Only the fields included in the request body are updated.",
        "parameters": [
          {
            "name": "docId",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "The automation ID to update."
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "title": {
                    "type": "string",
                    "description": "Automation name."
                  },
                  "docTemplateLink": {
                    "type": "string",
                    "format": "uri",
                    "description": "Google Doc template URL."
                  },
                  "newDocumentNameField": {
                    "type": "string",
                    "description": "Field name or formula for generated document names."
                  },
                  "isActive": {
                    "type": "boolean",
                    "description": "Whether the automation is active."
                  },
                  "saveGoogleDoc": {
                    "type": "boolean",
                    "description": "Save a Google Doc copy alongside the PDF."
                  },
                  "googleDocDestinationFolderUrl": {
                    "type": "string",
                    "format": "uri",
                    "description": "Google Drive folder URL for saved documents."
                  },
                  "locale": {
                    "type": "string",
                    "description": "Locale for date and number formatting (e.g., `en-us`, `de-de`)."
                  },
                  "formatNumbersWithLocale": {
                    "type": "boolean",
                    "description": "Format numbers using the automation's locale."
                  },
                  "pdfExpiration": {
                    "type": "string",
                    "nullable": true,
                    "enum": ["7d", "30d", "90d", null],
                    "description": "PDF expiration period. `null` for no expiration."
                  },
                  "imageOptions": {
                    "type": "object",
                    "properties": {
                      "quality": {
                        "type": "integer",
                        "description": "Image quality (1-100)."
                      },
                      "maxWidth": {
                        "type": "integer",
                        "description": "Maximum image width in pixels."
                      }
                    }
                  }
                }
              },
              "example": {
                "title": "Updated Invoice Generator",
                "isActive": true,
                "locale": "en-us"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Automation updated",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Success"
                    },
                    "updatedAutomation": {
                      "$ref": "#/components/schemas/Automation"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "404": {
            "$ref": "#/components/responses/NotFound"
          }
        }
      }
    },
    "/deleteAutomation": {
      "delete": {
        "operationId": "deleteAutomation",
        "tags": ["Automations"],
        "summary": "Delete automation",
        "description": "Permanently deletes an automation and all its settings. This action cannot be undone.",
        "parameters": [
          {
            "name": "docId",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "The automation ID to delete."
          }
        ],
        "responses": {
          "200": {
            "description": "Automation deleted",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Success"
                    }
                  }
                }
              }
            }
          },
          "404": {
            "$ref": "#/components/responses/NotFound"
          }
        }
      }
    },
    "/duplicateAutomation": {
      "post": {
        "operationId": "duplicateAutomation",
        "tags": ["Automations"],
        "summary": "Duplicate automation",
        "description": "Creates a copy of an existing automation with ' COPY' appended to the title.",
        "parameters": [
          {
            "name": "automationId",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "The automation ID to duplicate."
          }
        ],
        "responses": {
          "200": {
            "description": "Automation duplicated",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "newAutomationId": {
                      "type": "string",
                      "description": "The ID of the newly created automation."
                    }
                  }
                }
              }
            }
          },
          "404": {
            "$ref": "#/components/responses/NotFound"
          }
        }
      }
    },
    "/listPlaceholdersV2": {
      "get": {
        "operationId": "listPlaceholders",
        "tags": ["Templates"],
        "summary": "List template placeholders",
        "description": "Extracts and returns all placeholders from the automation's Google Doc template. Placeholders are grouped into `main` (top-level) and line item groups (`line_items_1`, `line_items_2`, etc.).",
        "parameters": [
          {
            "name": "automationId",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "The automation ID. The automation must have a template configured."
          }
        ],
        "responses": {
          "200": {
            "description": "Placeholders extracted",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "placeholders": {
                      "type": "object",
                      "properties": {
                        "main": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          },
                          "description": "Top-level placeholder names."
                        },
                        "line_items_1": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          },
                          "description": "Placeholders for the first line item group."
                        },
                        "line_items_2": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          },
                          "description": "Placeholders for the second line item group."
                        }
                      },
                      "additionalProperties": {
                        "type": "array",
                        "items": {
                          "type": "string"
                        }
                      }
                    }
                  },
                  "example": {
                    "placeholders": {
                      "main": ["customer_name", "invoice_date", "total"],
                      "line_items_1": ["description", "quantity", "rate", "amount"]
                    }
                  }
                }
              }
            }
          },
          "404": {
            "$ref": "#/components/responses/NotFound"
          }
        }
      }
    },
    "/duplicateGoogleDocTemplate": {
      "post": {
        "operationId": "duplicateTemplate",
        "tags": ["Templates"],
        "summary": "Duplicate template",
        "description": "Creates a copy of the Google Doc template associated with an automation. The new template is saved to your Google Drive.",
        "parameters": [
          {
            "name": "automationId",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "The automation ID."
          },
          {
            "name": "newTemplateName",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string"
            },
            "description": "Custom name for the duplicated template. Defaults to the automation title."
          }
        ],
        "responses": {
          "200": {
            "description": "Template duplicated",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Google Doc template duplicated successfully"
                    },
                    "newTemplateId": {
                      "type": "string",
                      "description": "Google Doc ID of the new template."
                    },
                    "url": {
                      "type": "string",
                      "format": "uri",
                      "description": "URL to edit the new template."
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "404": {
            "$ref": "#/components/responses/NotFound"
          }
        }
      }
    },
    "/sendTestEmail": {
      "post": {
        "operationId": "sendTestEmail",
        "tags": ["Email"],
        "summary": "Send test email",
        "description": "Sends a test email with a sample PDF attachment to verify your email configuration. Rate limited to 25 emails per hour per automation.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["automationId", "recipient"],
                "properties": {
                  "automationId": {
                    "type": "string",
                    "description": "The automation ID."
                  },
                  "recipient": {
                    "type": "string",
                    "format": "email",
                    "description": "Email address to send the test to."
                  }
                }
              },
              "example": {
                "automationId": "abc123",
                "recipient": "test@example.com"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Test email sent",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "Test email sent successfully to test@example.com"
                    },
                    "rateLimit": {
                      "type": "object",
                      "properties": {
                        "remaining": {
                          "type": "integer",
                          "description": "Remaining test emails this hour."
                        },
                        "resetAt": {
                          "type": "string",
                          "format": "date-time",
                          "description": "When the rate limit resets."
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "429": {
            "description": "Rate limit exceeded (25 per hour per automation)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/esign/sessions": {
      "get": {
        "operationId": "listSigningSessions",
        "tags": ["E-Signatures"],
        "summary": "List signing sessions",
        "description": "Retrieves signing sessions with optional filtering by status or signer email. Returns paginated results.",
        "parameters": [
          {
            "name": "status",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": ["pending", "in_progress", "completed", "declined", "cancelled"]
            },
            "description": "Filter by session status."
          },
          {
            "name": "email",
            "in": "query",
            "schema": {
              "type": "string"
            },
            "description": "Filter by signer email (partial match, case-insensitive)."
          },
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 1
            },
            "description": "Page number."
          },
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 20,
              "maximum": 250
            },
            "description": "Results per page (max 250)."
          }
        ],
        "responses": {
          "200": {
            "description": "Signing sessions list",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "sessions": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/SigningSessionSummary"
                      }
                    },
                    "pagination": {
                      "$ref": "#/components/schemas/Pagination"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          }
        }
      }
    },
    "/esign/sessions/{sessionId}": {
      "get": {
        "operationId": "getSigningSession",
        "tags": ["E-Signatures"],
        "summary": "Get session details",
        "description": "Returns comprehensive signing session information including signer statuses, e-sign fields with positions, document hashes, and completion timestamps.",
        "parameters": [
          {
            "name": "sessionId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "The signing session ID."
          }
        ],
        "responses": {
          "200": {
            "description": "Session details",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SigningSession"
                }
              }
            }
          },
          "404": {
            "$ref": "#/components/responses/NotFound"
          }
        }
      }
    },
    "/esign/sessions/{sessionId}/links": {
      "get": {
        "operationId": "getSigningLinks",
        "tags": ["E-Signatures"],
        "summary": "Get signing links",
        "description": "Retrieves signing links for all signers in a session. Useful for manual delivery mode or resending links.",
        "parameters": [
          {
            "name": "sessionId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "The signing session ID."
          }
        ],
        "responses": {
          "200": {
            "description": "Signing links",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "sessionId": {
                      "type": "string"
                    },
                    "documentName": {
                      "type": "string"
                    },
                    "deliveryMethod": {
                      "type": "string",
                      "enum": ["email", "link"]
                    },
                    "status": {
                      "type": "string"
                    },
                    "signers": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "signerIndex": {
                            "type": "integer"
                          },
                          "email": {
                            "type": "string"
                          },
                          "name": {
                            "type": "string"
                          },
                          "signingLink": {
                            "type": "string",
                            "format": "uri"
                          },
                          "expiresAt": {
                            "type": "string",
                            "format": "date-time"
                          },
                          "status": {
                            "type": "string"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "404": {
            "$ref": "#/components/responses/NotFound"
          }
        }
      }
    },
    "/esign/sessions/{sessionId}/audit": {
      "get": {
        "operationId": "getSigningAudit",
        "tags": ["E-Signatures"],
        "summary": "Get audit trail",
        "description": "Returns the complete chronological audit trail for a signing session, including all events like invitations, views, signatures, and completions.",
        "parameters": [
          {
            "name": "sessionId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "The signing session ID."
          }
        ],
        "responses": {
          "200": {
            "description": "Audit trail",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "sessionId": {
                      "type": "string"
                    },
                    "events": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/AuditEvent"
                      }
                    }
                  }
                }
              }
            }
          },
          "404": {
            "$ref": "#/components/responses/NotFound"
          }
        }
      }
    },
    "/esign/sessions/{sessionId}/cancel": {
      "post": {
        "operationId": "cancelSigningSession",
        "tags": ["E-Signatures"],
        "summary": "Cancel signing session",
        "description": "Cancels an active signing session. Cannot cancel sessions that are already completed.",
        "parameters": [
          {
            "name": "sessionId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "The signing session ID."
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "reason": {
                    "type": "string",
                    "description": "Optional cancellation reason."
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Session cancelled",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "Signing session has been cancelled"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Session already completed or invalid status",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "404": {
            "$ref": "#/components/responses/NotFound"
          }
        }
      }
    },
    "/esign/sessions/{sessionId}/resend/{signerIndex}": {
      "post": {
        "operationId": "resendSigningInvite",
        "tags": ["E-Signatures"],
        "summary": "Resend signing invitation",
        "description": "Resends the signing invitation email to a specific signer. Useful when the original email was missed or expired.",
        "parameters": [
          {
            "name": "sessionId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "The signing session ID."
          },
          {
            "name": "signerIndex",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "minimum": 1
            },
            "description": "The signer index (1-based)."
          }
        ],
        "responses": {
          "200": {
            "description": "Invitation resent",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "Invitation resent to john@example.com"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Signer already signed or invalid session status",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "404": {
            "$ref": "#/components/responses/NotFound"
          }
        }
      }
    }
  },
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "description": "API key from your workspace settings. Find it at [app.docsautomator.co/settings/workspace/api](https://app.docsautomator.co/settings/workspace/api)."
      }
    },
    "schemas": {
      "Error": {
        "type": "object",
        "properties": {
          "error": {
            "type": "string",
            "description": "Error message."
          }
        }
      },
      "LineItem": {
        "type": "object",
        "additionalProperties": true,
        "description": "A line item object. Keys correspond to line item placeholder names in your template. Use the `children` key for nested line items (up to 3 levels).",
        "properties": {
          "children": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/LineItem"
            },
            "description": "Nested child line items (supports up to 3 levels of nesting)."
          }
        }
      },
      "DocumentCreationResponse": {
        "type": "object",
        "properties": {
          "message": {
            "type": "string",
            "example": "success"
          },
          "pdfUrl": {
            "type": "string",
            "format": "uri",
            "description": "URL of the generated PDF."
          },
          "googleDocUrl": {
            "type": "string",
            "format": "uri",
            "description": "URL of the saved Google Doc (if `saveGoogleDoc` is enabled)."
          },
          "savePdfGoogleDriveUrl": {
            "type": "string",
            "format": "uri",
            "description": "Google Drive URL of the saved PDF (if Drive saving is configured)."
          },
          "savePdfGoogleDriveFileId": {
            "type": "string",
            "description": "Google Drive file ID of the saved PDF."
          },
          "signingSessionId": {
            "type": "string",
            "description": "E-signature session ID (if e-signing is enabled on the automation)."
          },
          "signingStatus": {
            "type": "string",
            "enum": ["created", "queued"],
            "description": "Status of the signing session creation."
          },
          "signingLinks": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "signerIndex": {
                  "type": "integer"
                },
                "email": {
                  "type": "string"
                },
                "name": {
                  "type": "string"
                },
                "signingUrl": {
                  "type": "string",
                  "format": "uri"
                },
                "status": {
                  "type": "string"
                }
              }
            },
            "description": "Signing links for each signer (if delivery method is `link`)."
          }
        }
      },
      "JobStatus": {
        "type": "object",
        "properties": {
          "jobId": {
            "type": "string"
          },
          "status": {
            "type": "string",
            "enum": ["waiting", "active", "completed", "failed"],
            "description": "Current job status."
          },
          "progress": {
            "type": "integer",
            "minimum": 0,
            "maximum": 100,
            "description": "Progress percentage (10 → 20 → 30 → 40 → 100)."
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          },
          "processedOn": {
            "type": "string",
            "format": "date-time",
            "description": "When processing started."
          },
          "finishedOn": {
            "type": "string",
            "format": "date-time",
            "description": "When processing finished."
          },
          "result": {
            "$ref": "#/components/schemas/DocumentCreationResponse",
            "description": "The document creation result (only present when status is `completed`)."
          },
          "error": {
            "type": "string",
            "description": "Error message (only present when status is `failed`)."
          },
          "attempts": {
            "type": "integer",
            "description": "Number of processing attempts."
          }
        }
      },
      "QueueStats": {
        "type": "object",
        "properties": {
          "waiting": {
            "type": "integer",
            "description": "Jobs waiting to be processed."
          },
          "active": {
            "type": "integer",
            "description": "Jobs currently being processed."
          },
          "completed": {
            "type": "integer",
            "description": "Completed jobs."
          },
          "failed": {
            "type": "integer",
            "description": "Failed jobs."
          },
          "delayed": {
            "type": "integer",
            "description": "Delayed jobs."
          }
        }
      },
      "Automation": {
        "type": "object",
        "properties": {
          "_id": {
            "type": "string",
            "description": "Automation ID."
          },
          "title": {
            "type": "string"
          },
          "dataSource": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string"
              }
            }
          },
          "dataSourceName": {
            "type": "string"
          },
          "docTemplateLink": {
            "type": "string",
            "format": "uri",
            "description": "Google Doc template URL."
          },
          "newDocumentNameField": {
            "type": "string"
          },
          "isActive": {
            "type": "boolean"
          },
          "saveGoogleDoc": {
            "type": "boolean"
          },
          "locale": {
            "type": "string"
          },
          "formatNumbersWithLocale": {
            "type": "boolean"
          },
          "pdfExpiration": {
            "type": "string",
            "nullable": true
          },
          "dateCreated": {
            "type": "string",
            "format": "date-time"
          },
          "lastPreviewPdf": {
            "type": "string",
            "format": "uri"
          }
        }
      },
      "SigningSessionSummary": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "documentName": {
            "type": "string"
          },
          "status": {
            "type": "string",
            "enum": ["pending", "in_progress", "completed", "declined", "cancelled"]
          },
          "signingOrder": {
            "type": "string",
            "enum": ["sequential", "parallel"]
          },
          "signers": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "index": {
                  "type": "integer"
                },
                "email": {
                  "type": "string"
                },
                "name": {
                  "type": "string"
                },
                "status": {
                  "type": "string"
                }
              }
            }
          },
          "expiresAt": {
            "type": "string",
            "format": "date-time"
          },
          "completedAt": {
            "type": "string",
            "format": "date-time",
            "nullable": true
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "SigningSession": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "documentName": {
            "type": "string"
          },
          "status": {
            "type": "string",
            "enum": ["pending", "in_progress", "completed", "declined", "cancelled"]
          },
          "signingOrder": {
            "type": "string",
            "enum": ["sequential", "parallel"]
          },
          "deliveryMethod": {
            "type": "string",
            "enum": ["email", "link"]
          },
          "currentSignerIndex": {
            "type": "integer"
          },
          "originalPdfUrl": {
            "type": "string",
            "format": "uri"
          },
          "signedPdfUrl": {
            "type": "string",
            "format": "uri",
            "nullable": true
          },
          "originalDocumentHash": {
            "type": "string"
          },
          "signedDocumentHash": {
            "type": "string",
            "nullable": true
          },
          "esignFields": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "fieldId": {
                  "type": "string"
                },
                "type": {
                  "type": "string",
                  "enum": ["signature", "text", "date", "checkbox"]
                },
                "label": {
                  "type": "string"
                },
                "required": {
                  "type": "boolean"
                },
                "value": {
                  "type": "string",
                  "nullable": true
                },
                "signedAt": {
                  "type": "string",
                  "format": "date-time",
                  "nullable": true
                },
                "signerIndex": {
                  "type": "integer"
                }
              }
            }
          },
          "signers": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "index": {
                  "type": "integer"
                },
                "email": {
                  "type": "string"
                },
                "name": {
                  "type": "string"
                },
                "role": {
                  "type": "string"
                },
                "status": {
                  "type": "string",
                  "enum": ["pending", "invited", "opened", "signed", "declined"]
                },
                "invitedAt": {
                  "type": "string",
                  "format": "date-time",
                  "nullable": true
                },
                "openedAt": {
                  "type": "string",
                  "format": "date-time",
                  "nullable": true
                },
                "signedAt": {
                  "type": "string",
                  "format": "date-time",
                  "nullable": true
                },
                "consentGivenAt": {
                  "type": "string",
                  "format": "date-time",
                  "nullable": true
                },
                "signingDurationSeconds": {
                  "type": "integer",
                  "nullable": true
                }
              }
            }
          },
          "reminderEnabled": {
            "type": "boolean"
          },
          "reminderDays": {
            "type": "integer"
          },
          "expiresAt": {
            "type": "string",
            "format": "date-time"
          },
          "completedAt": {
            "type": "string",
            "format": "date-time",
            "nullable": true
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "AuditEvent": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "eventType": {
            "type": "string",
            "enum": [
              "session_created",
              "invitation_sent",
              "link_opened",
              "document_viewed",
              "consent_given",
              "field_submitted",
              "signer_completed",
              "session_completed",
              "reminder_sent",
              "session_cancelled",
              "session_declined",
              "session_expired",
              "invite_resent"
            ],
            "description": "Type of audit event."
          },
          "actorType": {
            "type": "string",
            "enum": ["signer", "admin"]
          },
          "actorEmail": {
            "type": "string"
          },
          "actorSignerIndex": {
            "type": "integer",
            "nullable": true
          },
          "fieldId": {
            "type": "string",
            "nullable": true
          },
          "fieldType": {
            "type": "string",
            "nullable": true
          },
          "metadata": {
            "type": "object",
            "additionalProperties": true
          },
          "ipAddress": {
            "type": "string"
          },
          "userAgent": {
            "type": "string"
          },
          "timestamp": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "Pagination": {
        "type": "object",
        "properties": {
          "page": {
            "type": "integer"
          },
          "limit": {
            "type": "integer"
          },
          "total": {
            "type": "integer"
          },
          "pages": {
            "type": "integer"
          }
        }
      }
    },
    "responses": {
      "BadRequest": {
        "description": "Invalid request parameters",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/Error"
            },
            "example": {
              "error": "Missing required parameter"
            }
          }
        }
      },
      "Unauthorized": {
        "description": "Invalid or missing API key",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/Error"
            },
            "example": {
              "error": "Incorrect or missing API key"
            }
          }
        }
      },
      "NotFound": {
        "description": "Resource not found",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/Error"
            },
            "example": {
              "error": "Not found"
            }
          }
        }
      }
    }
  }
}
